$body=$("body"),goodsListModel={api:API_URL+"/goods/list",word:"",catId:0,listCountPerPage:12,page:1,attr:{},sort:{current:1,type:1,items:{1:{field:"default",title:"综合"},2:{field:"grade",title:"评分"},3:{field:"sale",title:"销量"},4:{field:"price",title:"价格"},5:{field:"up_time",title:"上架时间"}}},cateInit:function(t){return 0==t?!1:(this.catId=t,void this.init())},searchInit:function(t){return""==t?!1:(this.word=t,$(".site-header input[name='words']").val(decodeURIComponent(t)),void this.init())},init:function(){var t=this;$body.on("click","span.favorites",function(){var i=$(this).parent().attr("data-id");t.updateFavorite($(this),i)}),$body.on("click","span.add-cart",function(){var i=$(this).parent().attr("data-id");t.addCart(i)}),$(".nav-group li>a").on("click",function(){if(!$(this).hasClass("cur")){$(this).addClass("cur").siblings(".cur").removeClass("cur");var i=$(this).attr("data-attr").split("-");t.attrFilter(i[0],i[1])}}).each(function(){if($(this).hasClass("cur")){var i=$(this).attr("data-attr").split("-");0!=i[1]&&(t.attr[i[0]]=i[1])}}),t.sortInit(),t.loadGoods(!0)},sortInit:function(){var t=this,i="",a=$(".sort-group");$.each(t.sort.items,function(a,s){i+=a==t.sort.current?'<a href="javascript:void(0)" data-field="'+a+'" class="cur">'+s.title+"<span>↓</span></a>":'<a href="javascript:void(0)" data-field="'+a+'">'+s.title+"<span>↑</span></a>"}),a.html(i),a.find("a[data-field=1]>span").remove(),a.on("click","a",function(){$siblings=$(this).siblings(),$(this).addClass("cur").siblings(".cur").removeClass("cur"),t.sort.current==$(this).attr("data-field")?(t.sort.type=Math.abs(t.sort.type-1),$(this).find("span").text(1==t.sort.type?"↓":"↑")):(t.sort.current=$(this).attr("data-field"),t.sort.type=1,$(this).find("span").text("↓"),$siblings.find("span").text("↑")),t.loadGoods(!0)})},attrFilter:function(t,i){var a=this;a.attr[t]=i,a.loadGoods(!0)},query:function(){var t=this,i="",a="",s=t.sort;return i+="cat_id="+t.catId,i+="&word="+t.word,i+="&page="+t.page,$.each(t.attr,function(t,i){a+=""==a?t+"-"+i:"_"+t+"-"+i}),a&&(i+="&attr="+a),i+="&order="+s.items[s.current].field,i+="&sort="+(1==s.type?"desc":"asc")},loadGoods:function(t){var i=this,a=$(".items-list>ul");t=void 0!==t?t:!1,t&&(i.page=1),util.jsonp(this.api+"?"+i.query(),function(s){var o=s.list,n=i.goodsList(o);t?(""==n?n='<p class="nogoods">未找到匹配的商品</p>':i.topAd(),a.html(n)):a.append(n),o.length>0&&($(".items-list>ul img").lazyload(),o.length==i.listCountPerPage&&$(".lazy-next-page").lazyload())})},topAd:function(){util.jsonp(API_URL+"/commonApi/gInfo/g_key/102003",function(t){if(!$.isEmptyObject(t)){var i=t[0];$(".items-list>ul").prepend('<li class="top-ad"><a ga="商品列表置顶广告/click/PC-'+i.adId+'" href="'+i.url+'" target="'+i.link_target+'"><img src="'+i.img+'" loaded="1"></a></li>')}})},goodsList:function(t){var i=this,a="";return $.each(t,function(t,s){a+=i.goodsItem(s)}),a},goodsItem:function(t){function a(){return t.tag_image?'<div class="flag"><img src="'+placeholdImg+'" data-original="'+t.tag_image+'" alt=""></div>':""}function s(){var a='<p class="with-service">';if(t.tags.length>0){for(i in t.tags)a+=" <span>"+t.tags[i]+"</span>";a+="</p>"}return a}var o,n=this,e=util.goodsLink(t.id);return o='<li><div class="item-info"><div class="info-inner">'+a()+'<a class="image" href="'+e+'" target="_blank"><img src="'+placeholdImg+'" data-original="'+t.image+'" alt=""></a><div class="good-price cls"><span>¥'+t.price+"</span>"+s()+'</div><h3><a href="'+e+'" target="_blank">'+t.title+'</a></h3><div class="good-tips">'+t.ecovacs_description+'</div><p class="good-meta">销量: '+t.total_sale+' | 评论: <a href="'+SHOP_URL+"/comments-"+t.id+'.html" target="_blank">'+t.comments+'</a></p><div class="acts" data-id="'+t.id+'"><span class="favorites">'+n.favDom(t.is_favorite)+"</span>"+(t.is_internal?"":'<span class="add-cart"><i class="icon icon-cart"></i>加入购物车</span>')+"</div></div></div></li>"},favDom:function(t){return t?'<i class="icon icon-faved"></i>已收藏</span>':'<i class="icon icon-fav"></i>收藏</span>'},nextPage:function(){goodsListModel.page++,goodsListModel.loadGoods()},addCart:function(t){util.jsonp(SHOP_CART_URL+"/add/s/"+t+"_1",function(){alert("添加成功！")})},updateFavorite:function(t,i){var a=this;util.jsonp(API_URL+"/goods/favorite?goods_id="+i,function(i){t.html(a.favDom(i.is_favorite))})},recommendGoodsInit:function(t){var i={1:102004,5:102005,9:102006,12:102007,24:102008};void 0!==t&&0!=t&&i.hasOwnProperty(t)&&util.jsonp(API_URL+"/commonApi/gInfo/g_key/"+i[t],function(t){var i="",a=$.isEmptyObject(t)?[]:t;$.each(a,function(t,a){return t>2?!1:void(i+='<li><div class="child-item"><a href="'+a.url+'" target="'+a.link_target+'"><img src="'+a.img+'"></a> </div></li>')}),i&&$("#recommendGoods").html('<div class="sub-block"><ul class="children-list inline cls">'+i+"</ul></div>").fadeIn()})}};
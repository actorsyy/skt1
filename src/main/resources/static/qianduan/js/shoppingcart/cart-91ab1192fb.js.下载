var $body=$("body"),$cart=$("#cart"),$cartList=$(".cart-list"),$checkAll=$(".check.all i.checkbox"),cartModel={goods:{},manjianGoodsDom:"",commonGoodsDom:"",invalidGoodsDom:"",totalPrice:0,reducePrice:0,finalPrice:0,hasManjian:!1,selectAll:!0,init:function(){var i=this;cartData.items.length>0&&($.each(cartData.items,function(a,t){i.goods[t.id]=t}),!$.isEmptyObject(cartData.manjian)&&cartData.manjian.manjianId>0&&(i.hasManjian=!0,manjianModel.init(cartData.manjian))),this.refreshCart(),this.buttonInit(),this.checkboxInit(),i.loadHotGoods()},buttonInit:function(){var i=this;$cart.on("change",".amountAct>input",function(){var a=$(this).parent().attr("data-id"),t=+this.value;t>=1?i.amountUpdate(a,t):i.amountUpdate(a,1)}),$cart.on("click",".amountAct .minus, .amountAct .plus",function(){var a=$(this).siblings("input"),t=+$(this).parent().attr("data-id"),n=+a.val();$(this).hasClass("minus")&&n>1?i.amountUpdate(t,n-1):$(this).hasClass("plus")&&i.amountUpdate(t,n+1)}),$cart.on("click","span.del",function(){var a=$(this).parent().parent().attr("data-id");i.deleteGoods(a)}),$cart.on("click",".clear-btn",function(){i.deleteAll()}),$cart.on("click",".add_cart>button",function(){var a=$(this).attr("data-id");i.addGoods(a)}),$cart.on("click",".checkout-btn",function(){i.checkout()}),$cart.on("click",".peijian-add",function(){i.addGoods($(this).data("id"))})},checkboxInit:function(){var i=this;$checkAll.on("click",function(a){a.stopPropagation(),i.checkAllGoods(!$(this).hasClass("checked"))}),$cartList.on("click","i.checkbox",function(a){a.stopPropagation();var t=$(this).attr("data-id");i.checkGoods(t,!$(this).hasClass("checked"))})},renderGoods:function(){var i=this,a="";i.manjianGoodsDom=i.commonGoodsDom=i.invalidGoodsDom="",$.each(cartData.items,function(a,t){i.goodsItem(i.goods[t.id])}),""!=i.manjianGoodsDom&&(a+='<div class="manjian line"></div><div class="manjian-info"></div>',a+=i.manjianGoodsDom),""!=i.commonGoodsDom&&(a+='<div class="common line"></div>',a+=i.commonGoodsDom),""!=i.invalidGoodsDom&&(a+='<div class="invalid line"></div>',a+=i.invalidGoodsDom),$cartList.html(a)},goodsItem:function(i){var a,t=this,n="";i.manjianId>0&&i.valid?(a="manjian",n='<div data-id="'+i.id+'" class="item">'):i.valid?(a="common",n+='<div data-id="'+i.id+'" class="item">'):(a="invalid",n+='<div data-id="'+i.id+'" class="item invalid">');var A=util.goodsLink(i.id);if("invalid"!==a){var c=i.checked?" checked":"";""==i.image&&(i.image=placeholdImg),n+='<div class="check"><i class="iconfont checkbox'+c+'" data-id="'+i.id+'"></i></div>',n+='<div class="image"><a href="'+A+'" target="_blank"><img src="'+i.image+'"></a></div>'}else n+='<div class="check"></div>',n+='<div class="image"><a href="'+A+'" target="_blank"><img src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QNvaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjMtYzAxMSA2Ni4xNDU2NjEsIDIwMTIvMDIvMDYtMTQ6NTY6MjcgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6MEM5RkVDRkJFODU5RTYxMUEyNDBFNzJBMjQ3RTRFNDYiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NzMxOTRFOTE2M0ExMTFFNkFDMTFBMjA5N0VFQTQ4RDYiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NzMxOTRFOTA2M0ExMTFFNkFDMTFBMjA5N0VFQTQ4RDYiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpGQzA4RDBDM0ExNUVFNjExOTA2MENFOTFFREM1NjNCOCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDowQzlGRUNGQkU4NTlFNjExQTI0MEU3MkEyNDdFNEU0NiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6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"></a></div>';n+='<div class="title"><a href="'+A+'" target="_blank">'+i.title+"</a></div>",n+='<div class="price">'+i.price+"元</div>","invalid"!==a?(n+='<div class="amount"><div class="amountAct" data-id="'+i.id+'"><div class="minus">-</div><input type="text" maxlength="6" value="'+i.amount+'" autocomplete="off"><div class="plus">+</div></div></div>',n+='<div class="totalPrice">'+util.round(i.price*i.amount,2)+"元</div>"):n+='<div class="amount">'+i.invalidDesc+'</div><div class="totalPrice"></div>',n+='<div class="act"><span class="del">x</span></div>',n+="</div>","invalid"!==a&&(n+=t.giveaway(i.id,i.giveaway),n+=t.peijian(i.peijian)),t[a+"GoodsDom"]+=n},peijian:function(i){return i.map(function(i){return'\n<div class="peijian">\n<div class="fl">\n    <span class="peijian-add" data-id="'+i.id+'"></span>\n    <a href="'+util.goodsLink(i.id)+'"><img class="peijian-img" src="'+i.image+'"></a>\n</div>\n<div class="fr peijian-price">￥'+i.price+'</div>\n<div class="peijian-name"><a href="'+util.goodsLink(i.id)+'">'+i.title+"</a></div>\n</div>"}).join("")},giveaway:function(i,a){var t=this,n="";return void 0===a||0==a.length?n:($.each(a,function(a,A){var c=util.goodsLink(A.id);n+='<div class="item"><div class="image"><a href="'+c+'" target="_blank"><img src="'+A.image+'"></a></div><div class="title"><a href="'+c+'" target="_blank">'+A.title+'</a></div><div class="amount giveaway_'+i+'_nums" data-num="'+A.amount+'">'+A.amount*t.goods[i].amount+"</div></div>"}),n='<div id="giveaway-'+i+'" class="giveaway">'+n+"</div>")},checkGoods:function(i,a){this.goods[i].checked=a,this.refreshCart()},checkAllGoods:function(i){var a=this;$.each(a.goods,function(t,n){a.goods[t].checked=i}),this.refreshCart()},addGoods:function(i){var a=i+"_1";util.jsonp(SHOP_CART_URL+"/add/s/"+a,function(i){window.location.reload()})},amountUpdate:function(i,a){var t=this,n=i+"_"+a,A=$(".cart-list div.item[data-id='"+i+"']"),c=A.find("div.amount input"),e=A.find("div.totalPrice");return isNaN(a)||0>=a?(alert("数量必须是数字且大于1"),void c.val(1)):t.goods[i].buyLimit>0&&t.goods[i].buyLimit<a?(alert("该商品购买数不能超过"+t.goods[i].buyLimit),void c.val(t.goods[i].buyLimit)):void util.jsonp(SHOP_CART_URL+"/update/s/"+n,function(n){t.goods[i].amount=a,c.val(a),e.html(util.round(a*t.goods[i].price,2)+"元"),$(".giveaway_"+i+"_nums").each(function(){var i=parseInt($(this).attr("data-num"));$(this).text(i*a)}),t.refreshCart()},function(i){alert(i.msg),location.reload()})},deleteGoods:function(i){confirm("确定要删除么？")&&util.jsonp(SHOP_CART_URL+"/delete/"+i,function(){location.reload()})},deleteAll:function(){var i=this;confirm("确定要删除么？")&&util.jsonp(SHOP_CART_URL+"/deleteAll",function(){i.goods={},i.refreshCart()})},checkout:function(){var i=this,a="";return $.each(i.goods,function(i,t){t.valid&&t.checked&&(a+=a?"_"+t.id:t.id)}),""==a?(alert("请先选择商品！"),!1):void util.jsonp(SHOP_CART_URL+"/goCheckout/s/"+a,function(){location.href=SHOP_ORDER_URL+"/order/checkout"})},emptyCart:function(){$(".cart-main").html('<div class="cart-null"><div class="empty-cart"><p>您的购物车还是空的！</p><a href="'+SHOP_URL+'" class="goto-buy-btn">马上去购物</a></div></div>')},loadHotGoods:function(){var i="",a=0;util.jsonp(API_URL+"/home/hotSaleGoods",function(t){$.each(t,function(t,n){return n.url=util.goodsLink(n.id),""==n.image&&(n.image=placeholdImg),i+='<div class="col-3"><div class="item"><div class="image aspect"><a href="'+n.url+'"><img src="'+n.image+'" alt=""/></a></div><div class="title"><a href="'+n.url+'">'+n.title+'</a></div><div class="price">￥'+n.price+'</div><div class="add_cart"><button type="button" data-id="'+n.id+'">加入购物车</button></div></div></div>',a++,4==a?!1:void 0}),$cart.find(".recommend-goods .list").html(i)})},refreshCart:function(){var i=this;if($.isEmptyObject(i.goods))i.emptyCart();else{i.renderGoods();var a=$(".cart-count"),t=0,n=0,A=0,c=0,e=0;i.selectAll=!0,$.each(i.goods,function(a,c){c.valid&&(c.manjianId>0&&t++,c.checked?(e++,n+=c.price*c.amount,c.manjianId>0&&(A+=c.price*c.amount)):i.selectAll=!1)}),i.selectAll&&e>0&&(i.selectAll=!0),i.selectAll?$checkAll.addClass("checked"):$checkAll.removeClass("checked"),$(".checkout-btn").prop("disabled",e>0?!1:!0),i.hasManjian&&t&&(manjianModel.refresh(A),c=manjianModel.currentReducePrice),a.find(".reduce-price").html(c?"已减"+util.round(c,2)+"元":""),a.find(".total-price").html("总金额：<span>"+util.round(n-c,2)+"</span>元")}}},manjianModel={levels:{},desc:"",currentManjianLevelId:0,currentReducePrice:0,init:function(i){var a=this;a.manjianId=i.manjianId,a.title=i.title,a.desc=i.desc,$.each(i.levels,function(i,t){a.levels[t.manjianLevelId]=t})},refreshCartInfo:function(){var i='<span class="title">满减</span>';this.currentManjianLevelId>0&&(i+='<span class="current">可减'+this.currentReducePrice+"元：</span>"),i+='<span class="desc">'+this.desc+"</span>",i+='<a class="coudan" href="'+SHOP_URL+"/manjian-"+this.manjianId+'.html" target="_blank">去凑单></a>',$(".manjian-info").html(i)},refresh:function(i){var a=this,t=0,n=0;i>0&&$.each(a.levels,function(a,A){A.min<=i&&A.reduce>t&&(n=A.manjianLevelId,t=A.reduce)}),a.currentManjianLevelId!=n&&(a.currentManjianLevelId=n,a.currentReducePrice=t),a.refreshCartInfo()}};cartModel.init(),$(".site-logo>a").html('<span class="cart">我的购物车</span>');
function Tab(e){var n=0,t=e.next(".f-tab-content"),i=function(i){n=i,e.find("li:eq("+i+")").addClass("z-crt").siblings().removeClass("z-crt"),t.find(".f-tab-item:eq("+i+")").addClass("z-crt").siblings(".f-tab-item").removeClass("z-crt")};return i(0),e.on("click","li",function(e){e.stopPropagation(),i($(this).index())}),{index:function(){return n},select:i}}var mobileCheckUrl=ACCOUNT_URL+"/shopApi/commonApi/checkMobileExists",usernameCheckUrl=ACCOUNT_URL+"/shopApi/commonApi/checkUsernameExists",bindMobileUrl=ACCOUNT_URL+"/account/bindMobile/",oauthNewAccountPostUrl=ACCOUNT_URL+"/account/member/oauthSaveNewUser",oauthOldAccountPostUrl=ACCOUNT_URL+"/account/member/oauthSaveBindUser",findPwdPostUrl=ACCOUNT_URL+"/account/forgetPassword/resetPassword";+function(e){function n(e,n){var t=i.find("input[name='"+e+"']");if(t.length>0){t.focus();var a=t.next("span").length>0?t.next("span"):$('<span class="error f-tips"></span>').insertAfter(t);a.html(n)}else util.noMsg("<p>"+n+"</p>")}var t=$(window);if(void 0!==e){var i=$("#regloginForm"),a=i.find("input[name='mobile']");i.on("submit",function(){return!1}),i.prop("autocomplete","off").find("input[type='password']").prop("autocomplete","new-password"),$(".f-logo").css("cursor","pointer").on("click",function(){location.href=SHOP_URL}),$.validator.addMethod("isPassword",function(e,n){return this.optional(n)||e.length>=6&&e.length<=32&&!/^(\d+|[a-zA-Z]+|[^a-zA-Z0-9]+)$/.test(e)},"请输入6-32个字符，必须是字母、数字或符号的组合");var o={focusInvalid:!0,onkeyup:!1,onfocusout:function(e){$(e).valid()},errorPlacement:function(e,n){n.next("span").remove(),e.addClass("f-tips").insertAfter(n)},success:function(e){e.remove()},rules:{mobile:{required:!0,mobile:!0,remote:{url:mobileCheckUrl,type:"post",data:{mobile:function(){return $.trim(a.val())}}}},captcha:{required:!0},mobileCaptcha:{required:!0,digits:!0},password:{required:!0,isPassword:!0},password_old:{required:!0},password_new:{required:!0,isPassword:!0},password_confirm:{required:!0,equalTo:"#password"},account:{required:!0},username:{required:!0,remote:{url:usernameCheckUrl,type:"post",useRemoteMsg:!0,data:{username:function(){return $.trim($("input[name='username']").val())}}}}},messages:{mobile:{required:"请输入手机号"},captcha:{required:"请输入验证码！"},mobileCaptcha:{required:"请输入手机验证码！",digits:"验证码格式有误！"},password:{required:"请输入登录密码"},password_old:{required:"请输入登录密码"},password_new:{required:"请输入登录密码"},password_confirm:{required:"请再次输入新密码！",equalTo:"两次密码输入不一致"},account:{required:"请输入登录账号，可以是用户名或手机号"},username:{required:"请输入用户名",remote:"您输入的用户名已被占用"}}};$(".J-submit").each(function(){$('<span class="f-system-error"></span>').hide().insertAfter($(this))}),$("body").on("click","a.oauth",function(e){e.preventDefault();var n=$(this).attr("data-id");util.jsonp(ACCOUNT_URL+"/account/oauth/login?id="+n+"&callback="+callbackUrl,function(e){window.location.href=e})});var r=function(){function e(){s=new Captcha($(".J-captcha-box")),$(".image-captcha").show()}function t(){return i.find(".f-tab li.z-crt").prop("id")}function a(){var e="acountLogin"===t()?""===i.find("input[name='account']").val()||""===i.find("input[name='password']").val()||(self.isCaptcha?""===i.find("input[name='captcha']").val():!1):!/^1(3|4|5|7|8|9)\d{9}$/.test(i.find("input[name='loginMobile']").val())||""===i.find("input[name='mobileCaptcha']").val();l.prop("disabled",e)}var r,s,c,l=$(".J-submit"),u=$("#mobileCaptchaBtn"),d=i.find("input[name='_csrf']").val();return{isLock:!1,init:function(o){var c=this,u=o?window.parent:window;c.isCaptcha=needCaptcha,c.validate(),Tab(i.find(".f-tab")),c.isCaptcha&&e(),i.find("input").on("keyup change",function(){a()}),c.smsLogin(),l.on("click",function(){if("acountLogin"===t()){if(!r.element("input[name='account']")||!r.element("input[name='password']")||c.isCaptcha&&!r.element("input[name='captcha']"))return!1;l.prop("disabled",!0),util.post(i.prop("action"),i.serializeArray(),function(e){o?""!==e.url?u.location.href=e.url:(u.util.refreshUserInfo(),u.util.loginDialogClose()):location.href=e.url},function(t){t.needCaptcha&&(c.isCaptcha=!0,s?s.refresh():e()),n(t.data,t.msg)})}else{if(!r.element("input[name='loginMobile']")||!r.element("input[name='mobileCaptcha']"))return!1;l.prop("disabled",!0);var a={loginMobile:$.trim(i.find("input[name='loginMobile']").val()),mobileCaptcha:$.trim(i.find("input[name='mobileCaptcha']").val()),redirect:$.trim(i.find("input[name='redirect']").val()),_csrf:d};o&&(a.isMiniLogin=1),util.post("/account/member/smsSignin",a,function(e){o?(u.util.refreshUserInfo(),u.util.loginDialogClose(),"reg"===e.type&&window.parent.util.iframeDialog(e.url)):u.location.href=e.url},function(e){i.find("input[name='mobileCaptcha']").val("").focus(),d=e.data._csrf,n(e.data.field,e.msg)})}return!1}),$(".f-oauth .items i").on("click",function(e){e.preventDefault();var n=$(this).attr("data-id");util.jsonp(ACCOUNT_URL+"/account/oauth/login?id="+n+"&callback="+encodeURIComponent(callbackUrl),function(e){u.location.href=e})}),o||this.loginAd()},loginAd:function(){util.jsonp(API_URL+"/commonApi/gInfo/g_key/109004",function(e){if(!$.isEmptyObject(e)){var n=e[0];$(".m-login-ad").html('<a href="'+n.url+'" target="_blank" style="background-image: url('+n.img+')"></a>')}})},validate:function(){delete o.rules.password.isPassword,o.rules.password=o.rules.password_old,o.messages.password=o.messages.password_old,o.rules.loginMobile={required:!0,mobile:!0},o.messages.loginMobile={required:"请输入手机号"},r=i.validate(o)},smsLogin:function(){var e=i.find("input[name='loginMobile']");i.find("input[name='mobileCaptcha']");c=new SmsLoginCaptcha(u),e.on("keyup change",function(){if(!c.locked()){var e=i.find("input[name='loginMobile']").val();/^1(3|4|5|7|8|9)\d{9}$/.test(e)&&c.refresh()}});var t,a=function(){function n(e){u.text(e).show().delay(3e3).fadeOut()}var i,o='<div class="f-imgCaptcha"><div class="f-item"><div style="overflow: hidden"><div class="g-col7"><input type="text" name="captcha" class="u-ipt" placeholder="请输入图片验证码" id="imgCaptchaTxt"></div><div class="g-col4 J-smsLogin-captcha-box"></div></div></div><div style="margin-top: 10px;"><button type="button" disabled class="u-btn">确定</button></div></div>';i=new Mdialog({m:"imgCaptcha",closeType:"close",closeByEsc:!1,closeByMask:!1}),i.content(o);var r=$(".f-imgCaptcha"),s=$("#imgCaptchaTxt"),l=r.find("button");t=new Captcha(r.find(".J-smsLogin-captcha-box"));var u=$('<span class="error f-tips" style="display: none;"></span>').insertAfter(r.find(".J-smsLogin-captcha-box").parent());return s.on("keyup",function(){l.prop("disabled",""===this.value)}),l.click(function(){if(""===s.val())return void n("请填写手机及手机验证码！");var i={loginMobile:$.trim(e.val()),_csrf:d,captcha:$.trim(s.val())};c.send(i,function(e){d=e._csrf,a.close()},function(e){e.data.hasOwnProperty("_csrf")&&(d=e.data._csrf),"system"===e.data.field?(a.close(),util.noMsg(e.msg)):(n(e.msg),t.refresh())})}),i}();u.on("click",function(){if(r.element(e)){var i={loginMobile:$.trim(e.val()),_csrf:d,captcha:""};c.send(i,function(e){d=e._csrf},function(e){e.data.hasOwnProperty("_csrf")&&(d=e.data._csrf),n(e.data.field,e.msg),10018==e.code&&a.open(function(){t.refresh()})})}})}}},s=function(){var e,r,s,c=1;return{postData:{},mobile:"",init:function(){var l=this;t.on("beforeunload",function(e){return c>1?"您可能有数据没有保存":void e.preventDefault()}).on("unload",function(){$("input[name='agreement']").prop("checked",!1)}),r=new Captcha($(".J-captcha-box")),o.messages.mobile.remote='该手机号已注册！请&nbsp;<a href="'+loginUrl+'">直接登录</a>&nbsp;或&nbsp;<a href="'+findpwdUrl+'">找回密码</a>',e=i.validate(o),$("input[name='agreement']").on("change",function(){$(".J-submit.step-1").prop("disabled",!this.checked)}),$(".J-goback").on("click",function(){var e=l.step();l.go(e>1?e-1:1)});var u=$("input[name='mobileCaptcha']"),d=u.parent().parent().find("button");s=new SmsCaptcha(d,"signup"),d.on("click",function(){u.val("").focus(),s.send({mobile:l.mobile},function(){},function(e){n(e.data,e.msg)})}),$(".J-submit").on("click",function(){var o=$(this),c=l.step(),u={1:function(){if(!e.element("input[name='mobile']")||!e.element("input[name='captcha']"))return!1;if(!$("input[name='agreement']").prop("checked"))return n("system","请先同意会员注册协议"),!1;o.prop("disabled",!0);var t={mobile:$.trim(a.val()),captcha:$.trim($("input[name='captcha']").val())};s.send(t,function(){l.mobile=t.mobile,$(".mobile-number").text(t.mobile),l.go(2)},function(e){o.prop("disabled",!1),r.refresh(),n(e.data,e.msg)})},2:function(){if(!e.element("input[name='mobileCaptcha']"))return!1;o.prop("disabled",!0);var t={mobile:l.mobile,mobileCaptcha:$.trim(i.find("input[name='mobileCaptcha']").val())};s.valid(t,function(e){l.go(3)},function(e){o.prop("disabled",!1),n(e.data,e.msg)})},3:function(){if(!e.element("input[name='password']")||!e.element("input[name='username']"))return!1;o.prop("disabled",!0);var a={mobile:l.mobile,password:$.trim(i.find("input[name='password']").val()),username:$.trim(i.find("input[name='username']").val()),redirect:callbackUrl};util.post(registerAct,a,function(e){t.off("beforeunload"),location.href=e.url},function(e){o.prop("disabled",!1);var t;t="password"!==e.data||"username"!==e.data?"system":e.data,n(t,e.msg)})}};u[c]()})},step:function(){return c},go:function(n){c=n,$(".m-reg.step-"+n).show().siblings(".m-reg").hide(),1==n&&($(".step-1 .J-submit").prop("disabled",!1),r.refresh(),s.refresh()),e.resetForm()}}},c=function(){var e;return{init:function(){o.messages.password_old.required="请输入原登录密码",o.messages.password_new.required="请输入新密码",o.messages.password_confirm.required="请再次输入新密码",e=i.validate(o),i.on("submit",function(){return e.element("input[name='password_old']")&&e.element("input[name='password_new']")&&e.element("input[name='password_confirm']")?(util.post(i.prop("action"),i.serializeArray(),function(e){i.html('<div class="z-msg-success">密码修改成功，该密码将在下次登录时生效</div>')},function(e){n(e.data,e.msg)}),!1):!1})}}},l=function(){var e,r,s,c=1;return{mobile:"",init:function(){var l=this;r=new Captcha($(".J-captcha-box")),t.on("beforeunload",function(e){return c>1?"您可能有数据没有保存":void e.preventDefault()}),o.messages.mobile.remote="该手机号已被绑定",e=i.validate(o),$(".J-goback").on("click",function(){var e=l.step();l.go(e>1?e-1:1)});var u=$("input[name='mobileCaptcha']"),d=u.parent().parent().find("button");s=new SmsCaptcha(d,"bind"),d.on("click",function(){u.val("").focus(),s.send({mobile:l.mobile},function(){},function(e){n(e.data,e.msg)})}),$(".J-submit").on("click",function(){var o=$(this),c=l.step(),u={1:function(){if(!e.element("input[name='mobile']")||!e.element("input[name='captcha']"))return!1;o.prop("disabled",!0);var t={mobile:$.trim(a.val()),captcha:$.trim($("input[name='captcha']").val())};s.send(t,function(){l.mobile=t.mobile,$(".mobile-number").text(t.mobile),l.go(2)},function(e){o.prop("disabled",!1),r.refresh(),n(e.data,e.msg)})},2:function(){if(t.off("beforeunload"),!e.element("input[name='mobileCaptcha']"))return!1;o.prop("disabled",!0);var a={mobile:l.mobile,sms_code:$.trim(i.find("input[name='mobileCaptcha']").val())};util.post(i.prop("action"),a,function(e){l.go(3)},function(e){o.prop("disabled",!1),n(e.data,e.msg)})}};u[c]()})},step:function(){return c},go:function(n){c=n,$(".m-bindMobile.step-"+n).show().siblings(".m-bindMobile").hide(),1==n&&($(".step-1 .J-submit").prop("disabled",!1),r.refresh(),s.refresh()),e.resetForm()}}},u=function(){var e,r,s,c=1;return{mobile:"",init:function(){var l=this;r=new Captcha($(".J-captcha-box")),t.on("beforeunload",function(e){return c>1?"您可能有数据没有保存":void e.preventDefault()}),delete o.rules.mobile.remote,e=i.validate(o),$(".J-goback").on("click",function(){var e=l.step();l.go(e>1?e-1:1)}),$("#agreement").change(function(){$(".J-submit").prop("disabled",!$(this).prop("checked"))});var u=$("input[name='mobileCaptcha']"),d=u.parent().parent().find("button");s=new SmsSimpleCaptcha(d,"forcebind");var p,m=!1,f=function(e){"undefined"!=typeof p&&p.destroy();var n,t=function(){function t(e){u.text(e).show().delay(3e3).fadeOut()}var i,a='<div class="f-imgCaptcha"><div class="f-item"><div style="overflow: hidden"><div class="g-col7"><input type="text" name="captcha" class="u-ipt" placeholder="请输入图片验证码" id="imgCaptchaTxt"></div><div class="g-col4 J-smsLogin-captcha-box"></div></div></div><div style="margin-top: 10px;"><button type="button" disabled class="u-btn">确定</button></div></div>';i=new Mdialog({m:"imgCaptcha",closeType:"destroy",closeByEsc:!1,closeByMask:!1,closeCall:function(){1===l.step()&&l.go(1)}}),i.content(a);var o=$(".f-imgCaptcha"),r=$("#imgCaptchaTxt"),c=o.find("button");n=new Captcha(o.find(".J-smsLogin-captcha-box"));var u=$('<span class="error f-tips" style="display: none;"></span>').insertAfter(o.find(".J-smsLogin-captcha-box").parent());return r.on("keyup",function(){c.prop("disabled",""===this.value)}),c.click(function(){return""===r.val()?void t("请填写手机及手机验证码！"):(e.captcha=r.val(),void s.send(e,function(e){i.destroy(),l.go(2)},function(e){t(e.msg),n.refresh()}))}),i}();m?t.open(function(){n.refresh()}):s.send(e,function(){t.destroy(),l.go(2)},function(e){10018==e.code?(m=!0,t.open(function(){n.refresh()})):(l.go(1),util.noticeMsg(e.msg))})};$(".J-submit").on("click",function(){var o=$(this),s=l.step(),c={1:function(){if(!e.element("input[name='mobile']")||!e.element("input[name='captcha']"))return!1;o.prop("disabled",!0);var n={mobile:$.trim(a.val()),captcha:$.trim($("input[name='captcha']").val())};util.post("/account/beforeLogin/checkMobileStatus",n,function(e){l.mobile=n.mobile,$(".mobile-number").text(n.mobile);var t={mobile:l.mobile,type:e.next_method};if(i.find("input[name='_csrf']").val(e._csrf),d.off("click").on("click",function(){u.val("").focus(),f(t)}),"bindMobile"===e.next_method)f(t);else{var a={m:"msg",closeType:"destroy"};p=new Mdialog(a),"unbind"===e.next_method?p.content('<div class="confirm-msg"><div class="content">您输入的手机号已绑定科沃斯会员，您可以立即解绑，并将此手机号绑定到新账号，也可更换手机号进行绑定。</div><div class="f-action"><button class="u-btn J-doNext">立即解绑</button><button class="u-btn u-btn-c3 dialog-close">更换手机号</button></div></div>'):"bindAccount"===e.next_method&&p.content('<div class="confirm-msg"><div class="content">您输入的手机号已注册科沃斯会员，您可以选择继续绑定到已有账号，也可更换手机号进行绑定。</div><div class="f-action"><button class="u-btn J-doNext">继续绑定</button><button class="u-btn u-btn-c3 dialog-close">更换手机号</button></div></div>'),p.open(function(e){e.find(".dialog-close").one("click",function(){l.go(1)}),e.find(".J-doNext").one("click",function(){f(t)})})}},function(e){o.prop("disabled",!1),r.refresh(),util.noticeMsg(e.msg)})},2:function(){if(t.off("beforeunload"),!e.element("input[name='mobileCaptcha']"))return!1;o.prop("disabled",!0);var a={mobile:l.mobile,mobileCaptcha:$.trim(i.find("input[name='mobileCaptcha']").val())};util.post("/account/beforeLogin/validateMobile",a,function(e){"unbind"===e.next_method?window.location.href=e.redirect:(i.find(".step-3 .redirect").prop("href",e.redirect),l.go(3))},function(e){o.prop("disabled",!1),n(e.data.field,e.msg)})}};c[s]()})},step:function(){return c},go:function(n){c=n,$(".m-bindMobileV2.step-"+n).show().siblings(".m-bindMobileV2").hide(),1==n&&($(".step-1 .J-submit").prop("disabled",!1),r.refresh(),s.refresh()),e.resetForm()}}},d=function(){var e;return{init:function(){var t=new Tab($(".f-tab"));e=i.validate(o);var a=$("input[name='mobileCaptcha']"),r=a.parent().parent().find("button"),s=new SmsCaptcha(r,"unbind");r.on("click",function(){a.val("").focus(),util.post(ACCOUNT_URL+"/shopApi/sms/sendUnbindCode",{},function(e){s.lockButton()},function(e){n(e.data,e.msg)})}),i.on("submit",function(){var a={};if(0==t.index()){if(!e.element("input[name='mobileCaptcha']"))return!1;a.check_type="mobile",a.sms_code=$("input[name='mobileCaptcha']").val()}else{if(!e.element("input[name='password_old']"))return!1;a.check_type="password",a.password=$("input[name='password_old']").val()}return util.post(i.prop("action"),a,function(e){location.href=e.url},function(e){n(e.data,e.msg)}),!1})}}},p=function(){var e;return{init:function(){var t=new Tab($(".f-tab"));delete o.rules.username.remote,e=i.validate(o),i.on("submit",function(){var a={};if(0==t.index()){if(!e.element("input[name='username']"))return!1;a.username=$.trim($("input[name='username']").val()),util.post(oauthNewAccountPostUrl,a,function(e){location.href=bindMobileUrl},function(e){n(e.data,e.msg)})}else{if(!e.element("input[name='account']")||!e.element("input[name='password_old']"))return!1;a.account=$.trim($("input[name='account']").val()),a.password=$.trim($("input[name='password_old']").val()),util.post(oauthOldAccountPostUrl,a,function(e){var n=$("#bind-success");n.find(".account-name").text(a.account),i.remove(),n.show()},function(e){n(e.data,e.msg)})}return!1})}}},m=function(){var e,r,s,c=1;return{postData:{},mobile:"",init:function(){var l=this;t.on("beforeunload",function(e){return c>1?"您可能有数据没有保存":void e.preventDefault()}),r=new Captcha($(".J-captcha-box")),o.rules.mobile.remote.inverse=!0,o.messages.mobile.remote="用户不存在",e=i.validate(o),$(".J-goback").on("click",function(){var e=l.step();l.go(e>1?e-1:1)});var u=$("input[name='mobileCaptcha']"),d=u.parent().parent().find("button");s=new SmsCaptcha(d,"forget"),d.on("click",function(){u.val("").focus(),s.send({mobile:l.mobile},function(){},function(e){n(e.data,e.msg)})}),$(".J-submit").on("click",function(){var o=$(this),c=l.step(),u={1:function(){if(!e.element("input[name='mobile']")||!e.element("input[name='captcha']"))return!1;o.prop("disabled",!0);var t={mobile:$.trim(a.val()),captcha:$.trim($("input[name='captcha']").val())};s.send(t,function(){l.mobile=t.mobile,$(".mobile-number").text(t.mobile),l.go(2)},function(e){o.prop("disabled",!1),r.refresh(),n(e.data,e.msg)})},2:function(){if(!e.element("input[name='mobileCaptcha']"))return!1;o.prop("disabled",!0);var t={mobile:l.mobile,mobileCaptcha:$.trim(i.find("input[name='mobileCaptcha']").val())};s.valid(t,function(e){l.go(3)},function(e){o.prop("disabled",!1),n(e.data,e.msg)})},3:function(){if(!e.element("input[name='password']")||!e.element("input[name='password_confirm']"))return!1;o.prop("disabled",!0);var a={mobile:l.mobile,password:$.trim(i.find("input[name='password']").val()),password_confirm:$.trim(i.find("input[name='password_confirm']").val())};util.post(findPwdPostUrl,a,function(e){t.off("beforeunload"),l.go(4)},function(e){o.prop("disabled",!1),n(e.data,e.msg)})}};u[c]()})},step:function(){return c},go:function(n){c=n,$(".m-findpwd.step-"+n).show().siblings(".m-findpwd").hide(),1==n&&($(".step-1 .J-submit").prop("disabled",!1),r.refresh(),s.refresh()),e.resetForm()}}},f=function(){var e,t,r;return{mobile:$.trim(a.val()),init:function(){var s=this;t=new Captcha($(".J-captcha-box")),delete o.rules.mobile.remote,e=i.validate(o);var c=$("input[name='mobileCaptcha']"),l=c.parent().parent().find("button");r=new SmsCaptcha(l,"enterprise"),l.on("click",function(){c.val("").focus();var e={mobile:$.trim(a.val()),captcha:$.trim($("input[name='captcha']").val())};r.send(e,function(){},function(e){n(e.data,e.msg)})});var u=$("#f-captcha");a.on("change",function(){s.mobile!==this.value?u.show():u.hide()}),$(".J-submit").on("click",function(){var n=$(this);return e.element("input[name='mobile']")&&e.element("input[name='mobileCaptcha']")&&e.element("input[name='enterprise_id']")?(n.prop("disabled",!0),r.refresh(),void util.post("/account/enterprise/bind",i.serialize(),function(e){util.okMsg("绑定成功"),setTimeout(function(){location.href=SHOP_HOME_URL},3e3)},function(e){util.noMsg(e.msg),n.prop("disabled",!1)})):!1})}}};switch(pageCtl){case"login":r().init(!1);break;case"miniLogin":r().init(!0);break;case"register":s().init();break;case"resetPwd":c().init();break;case"bindMobile":l().init();break;case"bindMobileV2":u().init();break;case"bindEnterprise":f().init();break;case"unbind":unbind().init();break;case"changeBindMobile":d().init();break;case"oauthLogin":p().init();break;case"findPwd":m().init()}}}(pageCtl);